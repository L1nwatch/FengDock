{
    {$CADDY_GLOBAL_OPTIONS}
    admin off
}

{$DOMAIN} {
    encode gzip zstd

    handle_path /api/* {
        reverse_proxy backend:8000
    }

    handle {
        root * /srv/www
        @json_viewer {
            path "/tools/json-viewer"
            path "/tools/json-viewer/"
        }
        rewrite @json_viewer /tools/json-viewer.html
        try_files {path} /index.html
        file_server
    }

    @healthz path "/proxy-health"
    respond @healthz 200

    log {
        output stdout
        format console
    }
}
