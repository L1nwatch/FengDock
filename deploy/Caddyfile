{
    {$CADDY_GLOBAL_OPTIONS}
    admin off
}

{$DOMAIN} {
    encode gzip zstd

    handle_path /api/* {
        reverse_proxy backend:8000
    }

    @board path "/board"
    handle @board {
        reverse_proxy backend:8000
    }

    @board_slash path "/board/"
    handle @board_slash {
        reverse_proxy backend:8000
    }

    handle {
        root * /srv/www
        @json_viewer path "/tools/json-viewer"
        redir @json_viewer /tools/json-viewer.html 302
        @json_viewer_slash path "/tools/json-viewer/"
        redir @json_viewer_slash /tools/json-viewer.html 302
        try_files {path} /index.html
        file_server
    }

    @healthz path "/proxy-health"
    respond @healthz 200

    log {
        output stdout
        format console
    }
}
